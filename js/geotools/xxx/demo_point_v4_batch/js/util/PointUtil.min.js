var default_kx=102398.7799;var default_bx=-11072392.51;var default_ky=110894.2968;var default_by=-6411.974587;var default_kb={kx:default_kx,bx:default_bx,ky:default_ky,by:default_by};var kx,bx,ky,by;function setKB(a){kx=a.kx;bx=a.bx;ky=a.ky;by=a.by}function baidu_to_fs(d,c){var b=kx*d+bx;var a=ky*c+by;return{lon:b,lat:a}}function fs_to_baidu(d,c){var b=(d-bx)/kx;var a=(c-by)/ky;return{lon:b,lat:a}}function baidu_to_fs2(c){var b=baidu_to_fs(c.lon,c.lat);var a={lon:b.lon,lat:b.lat};return a}function fs_to_baidu2(c){var a=fs_to_baidu(c.lon,c.lat);var b={lon:a.lon,lat:a.lat};return b}function d2FS(c,b){var a=(c.lon-b.lon)*(c.lon-b.lon)+(c.lat-b.lat)*(c.lat-b.lat);return a}function dFS(c,b){var a=d2FS(c,b);return Math.sqrt(a)}var default_radius=1000;function getPointsInRadius(a,b){var c=[];point_pairs.forEach(function(e){var g={lon:e[0],lat:e[1]};var f=dFS(a,g);if(f<b){c.push(e)}});return c}var min_point_count=5;function getPointsInRadius_3Level(a,b){var c=getPointsInRadius(a,b);if(c.length<min_point_count){c=getPointsInRadius(a,1.5*b);if(c.length<min_point_count){c=getPointsInRadius(a,2*b)}}if(c.length<min_point_count){console.log("no enough points")}return c}function cal_kb(m){var c=m.length;var a=0,d=0,j=0;var g=0,e=0;for(var h=0;h<c;h++){a+=m[h].x*m[h].y;d+=m[h].x*m[h].x;j+=m[h].y*m[h].y;g+=m[h].x;e+=m[h].y}var f=(c*a-g*e)/(c*d-g*g);var l=e/c-f*g/c;return{k:f,b:l}}function calKB(e){if(e.length<2){return default_kb}var b=[];var a=[];e.forEach(function(g){b.push({x:g[2],y:g[0]});a.push({x:g[3],y:g[1]})});var d=cal_kb(b);var c=cal_kb(a);var f={kx:d.k,bx:d.b,ky:c.k,by:c.b};return f}function updateKB_ByPoint(b){var c=default_radius;var d=getPointsInRadius_3Level(b,c);var a=calKB(d);setKB(a)}function fs_to_baidu_allInOne(a){updateKB_ByPoint(a);var b=fs_to_baidu2(a);return b}function baidu_to_fs_allInOne(c){setKB(default_kb);var b=baidu_to_fs2(c);updateKB_ByPoint(b);var a=baidu_to_fs2(c);return a};